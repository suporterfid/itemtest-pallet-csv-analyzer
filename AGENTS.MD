# ğŸ¤– AGENTS.md â€” AI Development Guide for *ItemTestAnalyzer*

## ğŸ§­ Overview

This repository implements a **Python-based data analysis application** that processes CSV exports from **Impinj ItemTest** RFID reading tests.

The system supports **two operation modes**:

1. **Structured Mode (`--mode structured`)**
   Used for controlled RFID reading tests of totes or pallets where tags (EPCs) and their physical positions are known.
   Optionally uses a **pallet layout reference file** (CSV/XLSX/Markdown) for coverage mapping.

2. **Continuous Mode (`--mode continuous`)**
   Designed for **real-world operations**, such as unloading multiple pallets from a trailer at a distribution dock.
   In this mode, tags are **not known in advance**, and the system analyzes **continuous reading streams**, detecting EPC entries and exits dynamically.

This document provides **guidelines for AI agents** (Codex, Responses API, or Assistants) to safely extend or refactor the system.

---

## ğŸ§© Project Structure

```
ItemTestAnalyzer/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ analisar_itemtest.py     â† Main CLI entry point
â”‚   â”œâ”€â”€ parser.py                â† Parses Impinj ItemTest CSV logs
â”‚   â”œâ”€â”€ metrics.py               â† Computes EPC and antenna statistics
â”‚   â”œâ”€â”€ pallet_layout.py         â† Handles optional pallet layout reference
â”‚   â”œâ”€â”€ continuous_mode.py       â† Handles continuous stream analysis (dock unloading)
â”‚   â”œâ”€â”€ plots.py                 â† Generates charts using matplotlib
â”‚   â””â”€â”€ report.py                â† Builds Excel reports with xlsxwriter
â”œâ”€â”€ samples/
â”‚   â”œâ”€â”€ Teste_Estruturado.csv
â”‚   â”œâ”€â”€ Teste_Continuo.csv
â”‚   â””â”€â”€ Layout_Pallet_Exemplo.xlsx
â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ graficos/
â”‚   â””â”€â”€ logs/
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ run.bat
â””â”€â”€ README.md
```

---

## âš™ï¸ Agent Responsibilities

### ğŸ¯ Primary Goals

An AI agent working on this repository may:

1. **Enhance structured-mode analytics** â€” improve tag position correlation, layout validation, or coverage metrics.
2. **Develop continuous-mode logic** â€” detect tag flow, presence duration, and antenna-based movement patterns.
3. **Extend reporting** â€” add temporal charts, pallet flow dashboards, or executive summaries.
4. **Automate workflows** â€” multi-session batch processing or integration with Power BI.
5. **Support visualization** â€” implement interactive dashboards using Streamlit or FastAPI.

---

### ğŸ§± Must Preserve

* CLI entrypoint in `src/analisar_itemtest.py`
* Parameter usage:

  ```bash
  python src/analisar_itemtest.py --input <input_dir> --output <output_dir> [--layout <layout_file>] [--mode <structured|continuous>] [--window <seconds>]
  ```
* Windows 11 compatibility (UTF-8, spaces in paths)
* Backward compatibility with previous CSV format (Impinj ItemTest)
* Excel output consistency across modes (`Resumo_por_EPC`, `Leituras_por_Antena`, etc.)

---

## ğŸ§  System Behavior Summary

### Step 1 â€” Parse ItemTest CSV

* Ignore IP-like EPCs (`192.168.x.x`)
* Keep only valid hexadecimal EPCs (`[0-9A-F]{24,}`)
* Extract metadata:

  * `AntennaIDs`, `ModeIndex`, `PowersInDbm`, `Session`, `InventoryMode`, `Hostname`

---

### Step 2 â€” Structured Mode (with layout)

* Associate EPCs or suffixes with physical pallet positions.
* Generate sheet `Posicoes_Pallet` and calculate coverage rate.
* Mark missing tags and compute read distribution by side and height.

---

### Step 3 â€” Continuous Mode (dock unloading)

When `--mode continuous` is active or no layout file is provided:

1. **Group readings** by EPC and time window (configurable via `--window`, default = 2 seconds).
2. **Detect presence intervals:**

   * If an EPC stops appearing for longer than the window, mark as **â€œexited fieldâ€**.
3. **Compute metrics:**

   | Field                  | Description                     |
   | ---------------------- | ------------------------------- |
   | `duration_present`     | Total time EPC was detected     |
   | `read_events`          | Number of entry/exit events     |
   | `antenna_distribution` | Percentage of reads per antenna |
   | `direction_estimate`   | Approximate movement direction  |
4. **Generate summaries:**

   * EPCs per minute
   * Average dwell time
   * Antenna with highest detection rate
   * EPCs lingering too long (potential jam or read anomaly)

---

### Step 4 â€” Output Reports

**Excel outputs:**

* `Resumo_por_EPC` â€” all EPC stats
* `Leituras_por_Antena` â€” per-antenna performance
* `Fluxo_ContÃ­nuo` â€” (only in continuous mode) EPC entry/exit timeline
* `Metadata` â€” reader/session info
* `Posicoes_Pallet` â€” (only if layout available)

**Charts:**

* Reads per EPC
* Reads per Antenna
* RSSI Boxplot by Antenna
* EPCs Active over Time (continuous mode)
* Heatmap of antenna coverage (continuous mode)

**Text summary (auto-generated):**

> â€œDuring dock unloading from 14:00â€“14:15,
> reader `192.168.68.100` detected 1,280 unique EPCs
> average dwell: 3.4s, mean RSSI: â€“53.2 dBm,
> main antenna: 3 (base left).â€

---

## ğŸ§° Agent Action Map

| Agent Capability      | Module                 | Purpose                                          |
| --------------------- | ---------------------- | ------------------------------------------------ |
| Add new metrics       | `metrics.py`           | Extend structured mode calculations              |
| Add flow detection    | `continuous_mode.py`   | Implement EPC presence tracking and timing logic |
| Add new chart type    | `plots.py`             | Visualize movement, heatmaps, or trends          |
| Modify Excel layout   | `report.py`            | Add new worksheets or format summaries           |
| Add CLI options       | `analisar_itemtest.py` | Extend with `--mode` or `--window`               |
| Update parsing        | `parser.py`            | Adjust CSV header recognition or metadata logic  |
| Expand layout mapping | `pallet_layout.py`     | Handle multi-pallet or dynamic layouts           |

---

## ğŸ§  Suggested AI Tasks

| Task                                 | Goal                                                         | Tools                   |
| ------------------------------------ | ------------------------------------------------------------ | ----------------------- |
| `agent.add_continuous_mode()`        | Implement dynamic presence detection and time-based grouping | `pandas`, `numpy`       |
| `agent.calculate_dwell_time()`       | Add per-EPC dwell time and movement direction                | `datetime`, `pandas`    |
| `agent.extend_structured_coverage()` | Cross-analyze layout positions with read frequency           | `pandas`, `numpy`       |
| `agent.generate_flow_heatmap()`      | Visualize dock throughput over time                          | `matplotlib`, `seaborn` |
| `agent.add_window_parameter()`       | Add `--window` CLI argument for time threshold tuning        | `argparse`              |
| `agent.add_streamlit_ui()`           | Add interactive web dashboard for EPC activity visualization | `streamlit`, `plotly`   |
| `agent.create_pdf_summary()`         | Export executive PDF summaries with top metrics              | `reportlab`             |

---

## ğŸ§© Agent Development Rules

1. **Do not modify** core CLI parameters (`--input`, `--output`, `--layout`, `--mode`, `--window`).
2. **Preserve backward compatibility** with structured mode outputs.
3. **Use Pathlib for all file paths.**
4. **Ensure time-based grouping is parameterized** (window in seconds).
5. **Always log anomalies** â€” duplicate EPCs, missing timestamps, or inconsistent antennas.
6. **Document new functions** with purpose, parameters, and return values.
7. **Follow PEP8 and UTF-8** coding standards.

---

## ğŸ§  Future Extensions (AI Roadmap)

| Feature                  | Description                                            |
| ------------------------ | ------------------------------------------------------ |
| ğŸ”„ Multi-session summary | Aggregate several CSVs into one report                 |
| â± Real-time monitor      | Live dashboard for continuous mode (via Streamlit)     |
| ğŸ§­ Antenna calibration   | Calculate gain balance and coverage bias               |
| ğŸ§® Power BI export       | Generate standardized CSV for BI ingestion             |
| ğŸ§¾ PDF report            | Auto-generate executive summaries per session          |
| ğŸ§  Predictive analytics  | Identify â€œblind spotsâ€ using tag dwell and RSSI trends |

---

## ğŸ§© Prompt Template for AI Agents

```markdown
You are an AI software engineer contributing to the repository ItemTestAnalyzer.
Implement a feature according to the following guidelines:

- Mode support: structured and continuous.
- CLI must preserve arguments (--input, --output, --layout, --mode, --window).
- In continuous mode, analyze tag entry/exit and dwell times.
- In structured mode, maintain pallet layout correlation.

Use Python 3.11+, follow PEP8, and ensure UTF-8 compatibility on Windows 11.
Return full file code for any module you modify.
```

---

## ğŸ§  Summary

This repository serves as a **dual-mode platform** for RFID read analysis:

* **Structured Mode** for controlled pallet tests;
* **Continuous Mode** for live field scenarios such as dock unload monitoring.

Itâ€™s engineered for modular, AI-assisted evolution â€” enabling both human developers and AI agents to extend it toward full **traceability, performance insight, and automation** in real-world RFID deployments.


